version: '3.8'

services:
  range_bot:
    build:
      context: .
      dockerfile: Dockerfile.range
    container_name: chimerabot_range
    restart: unless-stopped
    
    environment:
      # Binance API
      - BINANCE_API_KEY=${BINANCE_API_KEY}
      - BINANCE_SECRET_KEY=${BINANCE_SECRET_KEY}
      - BINANCE_TESTNET=${BINANCE_TESTNET:-True}
      
      # Telegram
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID}
      
      # Range Bot Parameters
      - RANGE_LEVERAGE=${RANGE_LEVERAGE:-7}
      - RANGE_MARGIN_PER_TRADE=${RANGE_MARGIN_PER_TRADE:-10.0}
      - RANGE_MAX_OPEN_POSITIONS=${RANGE_MAX_OPEN_POSITIONS:-3}
      - RANGE_SCAN_INTERVAL=${RANGE_SCAN_INTERVAL:-300}
      
      # Range Detection
      - RANGE_MIN_WIDTH=${RANGE_MIN_WIDTH:-0.035}
      - RANGE_MIN_TOUCHES=${RANGE_MIN_TOUCHES:-3}
      - RANGE_MAX_AGE_HOURS=${RANGE_MAX_AGE_HOURS:-168}
      - RANGE_VOLUME_WEIGHT=${RANGE_VOLUME_WEIGHT:-0.3}
      
      # Risk Management
      - RANGE_MIN_SL_DISTANCE=${RANGE_MIN_SL_DISTANCE:-0.008}
      - RANGE_MIN_RR_RATIO=${RANGE_MIN_RR_RATIO:-2.0}
      - RANGE_MAX_POSITIONS_PER_SYMBOL=${RANGE_MAX_POSITIONS_PER_SYMBOL:-1}
      - RANGE_SL_BUFFER=${RANGE_SL_BUFFER:-0.008}
      - RANGE_TP_BUFFER=${RANGE_TP_BUFFER:-0.008}
      
      # Quality Filters
      - RANGE_MIN_QUALITY=${RANGE_MIN_QUALITY:-B}
      - RANGE_ALLOW_FALSE_BREAKOUTS=${RANGE_ALLOW_FALSE_BREAKOUTS:-False}
      - RANGE_MAX_FALSE_BREAKOUTS=${RANGE_MAX_FALSE_BREAKOUTS:-0}
      
      # Multi-Timeframe
      - RANGE_USE_HTF_CONFIRMATION=${RANGE_USE_HTF_CONFIRMATION:-True}
      - RANGE_HTF_TIMEFRAME=${RANGE_HTF_TIMEFRAME:-1h}
      - RANGE_HTF_MIN_OVERLAP=${RANGE_HTF_MIN_OVERLAP:-0.7}
      
      # Database & Logging
      - DATABASE_PATH=${DATABASE_PATH:-data/chimerabot.db}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - LOG_FILE=${LOG_FILE:-logs/range_bot.log}
    
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    
    networks:
      - chimerabot_network
    
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
    
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

networks:
  chimerabot_network:
    driver: bridge
