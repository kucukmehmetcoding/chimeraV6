[phases.setup]
cmds = [
  "apt-get update && apt-get install -y wget build-essential git gcc g++ make libc-dev python3-dev",
  "wget http://prdownloads.sourceforge.net/ta-lib/ta-lib-0.4.0-src.tar.gz && tar -xzf ta-lib-0.4.0-src.tar.gz && cd ta-lib/ && ./configure --prefix=/usr && make && make install && cd .. && rm -rf ta-lib ta-lib-0.4.0-src.tar.gz && ldconfig"
]

[phases.install]
cmds = [
  "pip install --no-cache-dir numpy==1.24.3",
  "pip install --no-cache-dir --no-binary :all: TA-Lib || pip install --no-cache-dir --verbose TA-Lib",
  "pip install -r requirements.txt"
]

[phases.build]
cmds = [
  "mkdir -p /app/data /app/logs",
  "chmod +x /app/docker-entrypoint.sh",
  "python3 migrations/add_advanced_risk_columns.py || true",
  "python3 migrations/add_amount_column.py || true"
]

[start]
cmd = "python -m src.main_orchestrator"

[build.env]
NODE_VERSION = "22"
PYTHON_VERSION = "3.11"
